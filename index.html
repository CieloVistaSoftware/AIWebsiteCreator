
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pro Website Creator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: white;
      overflow-x: hidden;
    }

    .header {
      background: #16213e;
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .header h1 {
      font-size: 1.3rem;
    }

    .menu-btn {
      padding: 0.8rem 1.2rem;
      background: #8b5cf6;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .menu-btn:active {
      transform: scale(0.95);
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      top: 4rem;
      right: 1rem;
      background: #0f3460;
      border-radius: 12px;
      padding: 0.5rem;
      min-width: 250px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      z-index: 150;
    }

    .dropdown-menu.active {
      display: block;
    }

    .dropdown-item {
      width: 100%;
      padding: 1rem;
      background: none;
      border: none;
      color: white;
      text-align: left;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      margin: 0.2rem 0;
    }

    .dropdown-item:active {
      background: #1a1a2e;
    }

    .view-mode {
      display: flex;
      gap: 0.5rem;
    }

    .view-btn {
      flex: 1;
      padding: 1.2rem;
      background: #0f3460;
      color: white;
      border: 3px solid transparent;
      border-radius: 10px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .view-btn:active {
      transform: scale(0.98);
    }

    .view-btn.active {
      background: #8b5cf6;
      border-color: #a78bfa;
      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
    }

    .tabs {
      display: flex;
      background: #0f3460;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 0.5rem;
    }

    .tab {
      flex: 1;
      padding: 0.9rem;
      background: none;
      border: none;
      color: #94a3b8;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s;
    }

    .tab.active {
      background: #1a1a2e;
      color: white;
    }

    .editor-section {
      display: block;
      min-height: 60vh;
    }

    .editor-section.hidden {
      display: none;
    }

    .editor-toolbar {
      background: #0f3460;
      padding: 0.8rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      overflow-x: auto;
    }

    .tool-btn {
      padding: 0.5rem 0.8rem;
      font-size: 0.85rem;
      background: #1a1a2e;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    textarea {
      width: 100%;
      min-height: 50vh;
      padding: 1rem;
      background: #1a1a2e;
      color: #e2e8f0;
      border: none;
      font-family: 'Courier New', monospace;
      font-size: 15px;
      line-height: 1.6;
      resize: vertical;
      outline: none;
    }

    .preview-section {
      display: none;
      min-height: 70vh;
    }

    .preview-section.active {
      display: block;
    }

    iframe {
      width: 100%;
      min-height: 70vh;
      border: none;
      background: transparent;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 200;
      overflow-y: auto;
      padding: 1rem;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: #16213e;
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .modal-header h2 {
      font-size: 1.3rem;
    }

    .close-btn {
      background: #ef4444;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
    }

    .template-grid {
      display: grid;
      gap: 1rem;
      margin-top: 1rem;
    }

    .template-card {
      background: #1a1a2e;
      padding: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .template-card:active {
      transform: scale(0.98);
    }

    .template-card h3 {
      margin-bottom: 0.5rem;
      color: #8b5cf6;
    }

    .snippet-btn {
      width: 100%;
      margin: 0.5rem 0;
      padding: 1rem;
      text-align: left;
      background: #1a1a2e;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
    }

    .color-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.8rem;
      margin: 1rem 0;
    }

    .color-box {
      aspect-ratio: 1;
      border-radius: 8px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.2s;
    }

    .color-box:active {
      transform: scale(0.9);
    }

    .project-item {
      background: #1a1a2e;
      padding: 1rem;
      margin: 0.5rem 0;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .project-actions {
      display: flex;
      gap: 0.5rem;
    }

    .tutorial-step {
      background: #1a1a2e;
      padding: 1rem;
      margin: 0.5rem 0;
      border-radius: 8px;
      border-left: 4px solid #8b5cf6;
    }

    .tutorial-step h3 {
      color: #8b5cf6;
      margin-bottom: 0.5rem;
    }

    input[type="text"], input[type="color"], select {
      width: 100%;
      padding: 0.8rem;
      margin: 0.5rem 0;
      background: #1a1a2e;
      border: 2px solid #0f3460;
      color: white;
      border-radius: 8px;
      font-size: 1rem;
    }

    .emoji-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .emoji-btn {
      padding: 0.8rem;
      font-size: 1.5rem;
      background: #1a1a2e;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .footer {
      background: #16213e;
      padding: 1rem;
      text-align: center;
      font-size: 0.85rem;
      color: #94a3b8;
    }

    .status-bar {
      background: #0f3460;
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      display: flex;
      justify-content: space-between;
    }

    button {
      touch-action: manipulation;
    }

    .btn-primary { background: #3b82f6; color: white; padding: 0.5rem 0.8rem; border: none; border-radius: 6px; cursor: pointer; }
    .btn-success { background: #10b981; color: white; padding: 0.5rem 0.8rem; border: none; border-radius: 6px; cursor: pointer; }
    .btn-red { background: #ef4444; color: white; padding: 0.5rem 0.8rem; border: none; border-radius: 6px; cursor: pointer; }
    .btn-orange { background: #f59e0b; color: white; padding: 0.5rem 0.8rem; border: none; border-radius: 6px; cursor: pointer; }
    .btn-purple { background: #8b5cf6; color: white; padding: 0.5rem 0.8rem; border: none; border-radius: 6px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-top">
      <h1>üöÄ Website Creator</h1>
      <button class="menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button>
    </div>

    <div class="dropdown-menu" id="dropdownMenu">
      <button class="dropdown-item" onclick="openModal('templates'); toggleMenu()">üìö Templates</button>
      <button class="dropdown-item" onclick="openModal('snippets'); toggleMenu()">‚ö° Snippets</button>
      <button class="dropdown-item" onclick="openModal('tools'); toggleMenu()">üé® Tools</button>
      <button class="dropdown-item" onclick="openModal('projects'); toggleMenu()">üíæ Projects</button>
      <button class="dropdown-item" onclick="openModal('tutorial'); toggleMenu()">üìñ Tutorial</button>
      <button class="dropdown-item" onclick="undo(); toggleMenu()">‚Ü∂ Undo</button>
      <button class="dropdown-item" onclick="redo(); toggleMenu()">‚Ü∑ Redo</button>
      <button class="dropdown-item" onclick="formatCode(); toggleMenu()">‚ú® Format Code</button>
      <button class="dropdown-item" onclick="downloadWebsite(); toggleMenu()">‚¨áÔ∏è Download</button>
    </div>

    <div class="view-mode">
      <button class="view-btn active" onclick="switchView('editor')">‚úèÔ∏è EDIT</button>
      <button class="view-btn" onclick="switchView('preview')">üëÅÔ∏è PREVIEW</button>
    </div>
  </div>

  <div class="status-bar">
    <span id="projectName">Untitled Project</span>
    <span id="autoSaveStatus">‚úÖ Auto-saved</span>
  </div>

  <div class="editor-section" id="editorSection">
    <div class="editor-toolbar">
      <button class="tool-btn" onclick="insertElement('h1')">H1</button>
      <button class="tool-btn" onclick="insertElement('h2')">H2</button>
      <button class="tool-btn" onclick="insertElement('p')">P</button>
      <button class="tool-btn" onclick="insertElement('button')">Button</button>
      <button class="tool-btn" onclick="insertElement('img')">üñºÔ∏è Image</button>
      <button class="tool-btn" onclick="insertElement('link')">üîó Link</button>
      <button class="tool-btn" onclick="openModal('emoji')">üòä Emoji</button>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('html')">HTML</button>
      <button class="tab" onclick="switchTab('css')">CSS</button>
      <button class="tab" onclick="switchTab('js')">JS</button>
    </div>
    <textarea id="htmlEditor"></textarea>
    <textarea id="cssEditor" style="display: none;"></textarea>
    <textarea id="jsEditor" style="display: none;"></textarea>
  </div>

  <div class="preview-section" id="previewSection">
    <iframe id="preview"></iframe>
  </div>

  <!-- Templates Modal -->
  <div class="modal" id="templatesModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üìö Templates</h2>
        <button class="close-btn" onclick="closeModal('templates')">‚úï</button>
      </div>
      <div class="template-grid">
        <div class="template-card" onclick="loadTemplate('basic')">
          <h3>üåü Basic</h3>
          <p>Simple starter template</p>
        </div>
        <div class="template-card" onclick="loadTemplate('portfolio')">
          <h3>üíº Portfolio</h3>
          <p>Showcase your work</p>
        </div>
        <div class="template-card" onclick="loadTemplate('landing')">
          <h3>üöÄ Landing Page</h3>
          <p>Product landing page</p>
        </div>
        <div class="template-card" onclick="loadTemplate('blog')">
          <h3>üìù Blog</h3>
          <p>Article-focused layout</p>
        </div>
        <div class="template-card" onclick="loadTemplate('restaurant')">
          <h3>üçï Restaurant</h3>
          <p>Menu and info page</p>
        </div>
        <div class="template-card" onclick="loadTemplate('resume')">
          <h3>üìÑ Resume</h3>
          <p>Professional CV</p>
        </div>
        <div class="template-card" onclick="loadTemplate('gallery')">
          <h3>üñºÔ∏è Photo Gallery</h3>
          <p>Image showcase</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Snippets Modal -->
  <div class="modal" id="snippetsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚ö° Code Snippets</h2>
        <button class="close-btn" onclick="closeModal('snippets')">‚úï</button>
      </div>
      <button class="snippet-btn" onclick="insertSnippet('navbar')">Navigation Bar</button>
      <button class="snippet-btn" onclick="insertSnippet('hero')">Hero Section</button>
      <button class="snippet-btn" onclick="insertSnippet('footer')">Footer</button>
      <button class="snippet-btn" onclick="insertSnippet('form')">Contact Form</button>
      <button class="snippet-btn" onclick="insertSnippet('card')">Card Component</button>
      <button class="snippet-btn" onclick="insertSnippet('grid')">Image Grid</button>
      <button class="snippet-btn" onclick="insertSnippet('button-styles')">Button Styles (CSS)</button>
      <button class="snippet-btn" onclick="insertSnippet('animations')">Animations (CSS)</button>
    </div>
  </div>

  <!-- Tools Modal -->
  <div class="modal" id="toolsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üé® Tools</h2>
        <button class="close-btn" onclick="closeModal('tools')">‚úï</button>
      </div>
      
      <h3 style="margin: 1rem 0;">Color Picker</h3>
      <input type="color" id="colorPicker" value="#667eea" style="height: 50px;">
      <button class="btn-primary" style="width: 100%; margin-top: 0.5rem;" onclick="insertColor()">Insert Color</button>
      
      <h3 style="margin: 1rem 0;">Color Schemes</h3>
      <div class="color-grid">
        <div class="color-box" style="background: #667eea;" onclick="applyColorScheme('purple')"></div>
        <div class="color-box" style="background: #3b82f6;" onclick="applyColorScheme('blue')"></div>
        <div class="color-box" style="background: #10b981;" onclick="applyColorScheme('green')"></div>
        <div class="color-box" style="background: #ef4444;" onclick="applyColorScheme('red')"></div>
        <div class="color-box" style="background: #1a1a2e;" onclick="applyColorScheme('dark')"></div>
        <div class="color-box" style="background: #f8f9fa;" onclick="applyColorScheme('light')"></div>
        <div class="color-box" style="background: #fbbf24;" onclick="applyColorScheme('sunset')"></div>
        <div class="color-box" style="background: #ec4899;" onclick="applyColorScheme('pink')"></div>
      </div>

      <h3 style="margin: 1rem 0;">Google Fonts</h3>
      <select id="fontSelector" onchange="applyFont()">
        <option value="Arial, sans-serif">Arial</option>
        <option value="'Georgia', serif">Georgia</option>
        <option value="'Courier New', monospace">Courier New</option>
        <option value="'Helvetica Neue', sans-serif">Helvetica</option>
        <option value="'Times New Roman', serif">Times New Roman</option>
        <option value="'Verdana', sans-serif">Verdana</option>
        <option value="'Comic Sans MS', cursive">Comic Sans</option>
      </select>
    </div>
  </div>

  <!-- Projects Modal -->
  <div class="modal" id="projectsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üíæ My Projects</h2>
        <button class="close-btn" onclick="closeModal('projects')">‚úï</button>
      </div>
      <input type="text" id="projectNameInput" placeholder="Project Name">
      <button class="btn-success" style="width: 100%; margin: 0.5rem 0;" onclick="saveProject()">üíæ Save Current Project</button>
      <button class="btn-primary" style="width: 100%; margin: 0.5rem 0;" onclick="exportProject()">üì§ Export Project</button>
      <button class="btn-orange" style="width: 100%; margin: 0.5rem 0;" onclick="document.getElementById('importFile').click()">üì• Import Project</button>
      <input type="file" id="importFile" style="display: none;" onchange="importProject(event)" accept=".json">
      
      <h3 style="margin: 1rem 0;">Saved Projects</h3>
      <div id="projectsList"></div>
    </div>
  </div>

  <!-- Emoji Modal -->
  <div class="modal" id="emojiModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üòä Emoji Picker</h2>
        <button class="close-btn" onclick="closeModal('emoji')">‚úï</button>
      </div>
      <div class="emoji-grid" id="emojiGrid"></div>
    </div>
  </div>

  <!-- Tutorial Modal -->
  <div class="modal" id="tutorialModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üìñ Tutorial</h2>
        <button class="close-btn" onclick="closeModal('tutorial')">‚úï</button>
      </div>
      
      <div class="tutorial-step">
        <h3>1Ô∏è‚É£ Getting Started</h3>
        <p>Use the tabs to switch between HTML, CSS, and JavaScript. Edit your code in the editor and click Preview to see changes!</p>
      </div>

      <div class="tutorial-step">
        <h3>2Ô∏è‚É£ Using Templates</h3>
        <p>Click the Menu button, then Templates to load pre-made designs. Choose from Portfolio, Blog, Restaurant, and more!</p>
      </div>

      <div class="tutorial-step">
        <h3>3Ô∏è‚É£ Quick Elements</h3>
        <p>Use the toolbar buttons (H1, H2, P, Button) to quickly insert HTML elements.</p>
      </div>

      <div class="tutorial-step">
        <h3>4Ô∏è‚É£ Code Snippets</h3>
        <p>The Snippets menu has ready-made components like navigation bars, forms, and cards. Just click to insert!</p>
      </div>

      <div class="tutorial-step">
        <h3>5Ô∏è‚É£ Color Tools</h3>
        <p>Use the color picker and pre-made color schemes in the Tools menu to style your site quickly.</p>
      </div>

      <div class="tutorial-step">
        <h3>6Ô∏è‚É£ Saving Projects</h3>
        <p>Your work auto-saves! You can also save multiple projects and switch between them in the Projects menu.</p>
      </div>

      <div class="tutorial-step">
        <h3>7Ô∏è‚É£ Undo & Redo</h3>
        <p>Made a mistake? Use the Undo/Redo options in the menu to go back or forward in your edits.</p>
      </div>

      <div class="tutorial-step">
        <h3>8Ô∏è‚É£ Download</h3>
        <p>When you're done, use the Download option in the menu to get your complete website as a single HTML file!</p>
      </div>
    </div>
  </div>

  <div class="footer">
    Pro Website Creator - Tap Menu for all options!
  </div>

  <script>
    // State management
    let currentTab = 'html';
    let history = { html: [], css: [], js: [] };
    let historyIndex = { html: -1, css: -1, js: -1 };
    let autoSaveInterval;

    const htmlEditor = document.getElementById('htmlEditor');
    const cssEditor = document.getElementById('cssEditor');
    const jsEditor = document.getElementById('jsEditor');
    const preview = document.getElementById('preview');

    // Default content
    const defaultHTML = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Website</title>
</head>
<body>
  <header>
    <h1>Welcome to My Website</h1>
    <nav>
      <a href="#home">Home</a>
      <a href="#about">About</a>
      <a href="#contact">Contact</a>
    </nav>
  </header>
  
  <main>
    <section id="home">
      <h2>Home Section</h2>
      <p>Start building your amazing website here!</p>
    </section>
  </main>
  
  <footer>
    <p>&copy; 2025 My Website</p>
  </footer>
</body>
</html>`;

    const defaultCSS = `* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: Arial, sans-serif;
  line-height: 1.6;
  color: #333;
}

header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 2rem;
  text-align: center;
}

nav {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-top: 1rem;
}

nav a {
  color: white;
  text-decoration: none;
  padding: 0.5rem 1rem;
  border-radius: 5px;
}

main {
  padding: 2rem;
  max-width: 1200px;
  margin: 0 auto;
}

section {
  margin: 2rem 0;
  padding: 2rem;
  background: #f8f9fa;
  border-radius: 10px;
}

footer {
  background: #333;
  color: white;
  text-align: center;
  padding: 1.5rem;
}`;

    const defaultJS = `document.addEventListener('DOMContentLoaded', function() {
  console.log('Website loaded!');
});`;

    // Toggle dropdown menu
    function toggleMenu() {
      const menu = document.getElementById('dropdownMenu');
      menu.classList.toggle('active');
    }

    // Close menu when clicking outside
    document.addEventListener('click', function(e) {
      const menu = document.getElementById('dropdownMenu');
      const menuBtn = document.querySelector('.menu-btn');
      if (!menu.contains(e.target) && !menuBtn.contains(e.target)) {
        menu.classList.remove('active');
      }
    });

    // Initialize
    function init() {
      loadFromStorage();
      setupEventListeners();
      setupEmojis();
      startAutoSave();
      updateProjectsList();
      updatePreview();
    }

    function loadFromStorage() {
      const saved = localStorage.getItem('currentProject');
      if (saved) {
        const data = JSON.parse(saved);
        htmlEditor.value = data.html || defaultHTML;
        cssEditor.value = data.css || defaultCSS;
        jsEditor.value = data.js || defaultJS;
        document.getElementById('projectName').textContent = data.name || 'Untitled Project';
      } else {
        htmlEditor.value = defaultHTML;
        cssEditor.value = defaultCSS;
        jsEditor.value = defaultJS;
      }
      
      // Initialize history
      addToHistory('html');
      addToHistory('css');
      addToHistory('js');
    }

    function setupEventListeners() {
      htmlEditor.addEventListener('input', () => {
        addToHistory('html');
        updatePreview();
      });
      cssEditor.addEventListener('input', () => {
        addToHistory('css');
        updatePreview();
      });
      jsEditor.addEventListener('input', () => {
        addToHistory('js');
        updatePreview();
      });
    }

    function startAutoSave() {
      autoSaveInterval = setInterval(() => {
        const data = {
          name: document.getElementById('projectName').textContent,
          html: htmlEditor.value,
          css: cssEditor.value,
          js: jsEditor.value
        };
        localStorage.setItem('currentProject', JSON.stringify(data));
        document.getElementById('autoSaveStatus').textContent = '‚úÖ Auto-saved';
      }, 5000);
    }

    function addToHistory(type) {
      const editor = type === 'html' ? htmlEditor : type === 'css' ? cssEditor : jsEditor;
      const value = editor.value;
      
      history[type] = history[type].slice(0, historyIndex[type] + 1);
      history[type].push(value);
      historyIndex[type] = history[type].length - 1;
      
      if (history[type].length > 50) {
        history[type].shift();
        historyIndex[type]--;
      }
    }

    function undo() {
      if (historyIndex[currentTab] > 0) {
        historyIndex[currentTab]--;
        const editor = currentTab === 'html' ? htmlEditor : currentTab === 'css' ? cssEditor : jsEditor;
        editor.value = history[currentTab][historyIndex[currentTab]];
        updatePreview();
      }
    }

    function redo() {
      if (historyIndex[currentTab] < history[currentTab].length - 1) {
        historyIndex[currentTab]++;
        const editor = currentTab === 'html' ? htmlEditor : currentTab === 'css' ? cssEditor : jsEditor;
        editor.value = history[currentTab][historyIndex[currentTab]];
        updatePreview();
      }
    }

    function updatePreview() {
      const html = htmlEditor.value;
      const css = cssEditor.value;
      const js = jsEditor.value;

      const content = `
        <!DOCTYPE html>
        <html>
          <head>
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <style>${css}</style>
          </head>
          <body>
            ${html.replace(/<!DOCTYPE html>|<html[^>]*>|<\/html>|<head[^>]*>|<\/head>|<body[^>]*>|<\/body>/gi, '')}
            <script>${js}<\/script>
          </body>
        </html>
      `;

      preview.srcdoc = content;
    }

    function setPreviewBackground(iframe, color) {
      if (!iframe) return;
      
      try {
        const doc = iframe.contentDocument || iframe.contentWindow?.document;
        if (!doc) return;
        
        // Ensure body element exists
        if (!doc.body) {
          // Wait for iframe to load if body doesn't exist yet
          iframe.addEventListener('load', () => {
            const loadedDoc = iframe.contentDocument || iframe.contentWindow?.document;
            if (loadedDoc?.body) {
              loadedDoc.body.style.backgroundColor = color;
            }
          }, { once: true });
        } else {
          doc.body.style.backgroundColor = color;
        }
      } catch (e) {
        // Silently fail if we can't access the iframe (cross-origin, etc.)
        return;
      }
    }

    function switchTab(tab) {
      currentTab = tab;
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');

      htmlEditor.style.display = tab === 'html' ? 'block' : 'none';
      cssEditor.style.display = tab === 'css' ? 'block' : 'none';
      jsEditor.style.display = tab === 'js' ? 'block' : 'none';
    }

    function switchView(view) {
      const editorSection = document.getElementById('editorSection');
      const previewSection = document.getElementById('previewSection');
      const viewBtns = document.querySelectorAll('.view-btn');

      viewBtns.forEach(btn => btn.classList.remove('active'));

      if (view === 'editor') {
        editorSection.classList.remove('hidden');
        previewSection.classList.remove('active');
        viewBtns[0].classList.add('active');
      } else {
        editorSection.classList.add('hidden');
        previewSection.classList.add('active');
        viewBtns[1].classList.add('active');
        updatePreview();
      }
    }

    function openModal(id) {
      document.getElementById(id + 'Modal').classList.add('active');
    }

    function closeModal(id) {
      document.getElementById(id + 'Modal').classList.remove('active');
    }

    function insertElement(type) {
      const editor = htmlEditor;
      const pos = editor.selectionStart;
      let text = '';
      
      switch(type) {
        case 'h1':
          text = '<h1>Heading 1</h1>\n';
          break;
        case 'h2':
          text = '<h2>Heading 2</h2>\n';
          break;
        case 'p':
          text = '<p>Your paragraph text here</p>\n';
          break;
        case 'button':
          text = '<button>Click Me</button>\n';
          break;
        case 'img':
          text = '<img src="https://via.placeholder.com/400" alt="Description">\n';
          break;
        case 'link':
          text = '<a href="https://example.com">Link Text</a>\n';
          break;
      }
      
      editor.value = editor.value.substring(0, pos) + text + editor.value.substring(pos);
      editor.focus();
      addToHistory('html');
      updatePreview();
    }

    function formatCode() {
      const editor = currentTab === 'html' ? htmlEditor : currentTab === 'css' ? cssEditor : jsEditor;
      let formatted = editor.value;
      
      formatted = formatted.replace(/>\s*</g, '>\n<');
      formatted = formatted.replace(/{\s*/g, ' {\n  ');
      formatted = formatted.replace(/;\s*/g, ';\n  ');
      formatted = formatted.replace(/}\s*/g, '\n}\n');
      
      editor.value = formatted;
      addToHistory(currentTab);
      updatePreview();
      alert('‚ú® Code formatted!');
    }

    function insertColor() {
      const color = document.getElementById('colorPicker').value;
      const editor = currentTab === 'css' ? cssEditor : htmlEditor;
      const pos = editor.selectionStart;
      editor.value = editor.value.substring(0, pos) + color + editor.value.substring(pos);
      editor.focus();
      addToHistory(currentTab);
      updatePreview();
      closeModal('tools');
    }

    function applyFont() {
      const font = document.getElementById('fontSelector').value;
      const pos = cssEditor.value.indexOf('font-family:');
      if (pos !== -1) {
        const end = cssEditor.value.indexOf(';', pos);
        cssEditor.value = cssEditor.value.substring(0, pos) + 
                         `font-family: ${font}` + 
                         cssEditor.value.substring(end);
      } else {
        cssEditor.value = `body {\n  font-family: ${font};\n}\n\n` + cssEditor.value;
      }
      addToHistory('css');
      updatePreview();
    }

    function applyColorScheme(scheme) {
      const schemes = {
        purple: { primary: '#667eea', secondary: '#764ba2' },
        blue: { primary: '#3b82f6', secondary: '#1d4ed8' },
        green: { primary: '#10b981', secondary: '#059669' },
        red: { primary: '#ef4444', secondary: '#dc2626' },
        dark: { primary: '#1a1a2e', secondary: '#16213e' },
        light: { primary: '#f8f9fa', secondary: '#e9ecef' },
        sunset: { primary: '#fbbf24', secondary: '#f59e0b' },
        pink: { primary: '#ec4899', secondary: '#db2777' }
      };
      
      const colors = schemes[scheme];
      cssEditor.value = cssEditor.value.replace(/#667eea/g, colors.primary);
      cssEditor.value = cssEditor.value.replace(/#764ba2/g, colors.secondary);
      
      addToHistory('css');
      updatePreview();
      
      // Also directly set the preview background to ensure it applies
      setTimeout(() => {
        setPreviewBackground(preview, colors.primary);
      }, 100);
      
      closeModal('tools');
      alert('‚úÖ Color scheme applied!');
    }

    function setupEmojis() {
      const emojis = ['üòÄ','üòÉ','üòÑ','üòÅ','üòÖ','üòÇ','ü§£','üòä','üòá','üôÇ','üôÉ','üòâ','üòå','üòç','ü•∞','üòò','üòó','üòô','üòö','üòã','üòõ','üòù','üòú','ü§™','ü§®','üßê','ü§ì','üòé','ü§©','ü•≥','üòè','üòí','üòû','üòî','üòü','üòï','üôÅ','üò£','üòñ','üò´','üò©','ü•∫','üò¢','üò≠','üò§','üò†','üò°','ü§¨','ü§Ø','üò≥','ü•µ','ü•∂','üò±','üò®','üò∞','üò•','üòì','ü§ó','ü§î','ü§≠','ü§´','ü§•','üò∂','üòê','üòë','üò¨','üôÑ','üòØ','üò¶','üòß','üòÆ','üò≤','ü•±','üò¥','ü§§','üò™','üòµ','ü§ê','ü•¥','ü§¢','ü§Æ','ü§ß','üò∑','ü§í','ü§ï','ü§ë','ü§†','‚ù§Ô∏è','üíõ','üíö','üíô','üíú','üñ§','ü§ç','ü§é','üíî','‚ù£Ô∏è','üíï','üíû','üíì','üíó','üíñ','üíò','üíù','üî•','‚ú®','üí´','‚≠ê','üåü','‚úÖ','‚ùå','‚ö°','üí°','üéâ','üéä','üéà','üéÅ','üèÜ','ü•á','ü•à','ü•â','üëç','üëé','üëå','ü§ü','ü§ò','üëè','üôå','üëê','ü§≤','ü§ù','üôè'];
      
      const grid = document.getElementById('emojiGrid');
      emojis.forEach(emoji => {
        const btn = document.createElement('button');
        btn.className = 'emoji-btn';
        btn.textContent = emoji;
        btn.onclick = () => {
          const editor = htmlEditor;
          const pos = editor.selectionStart;
          editor.value = editor.value.substring(0, pos) + emoji + editor.value.substring(pos);
          editor.focus();
          addToHistory('html');
          updatePreview();
          closeModal('emoji');
        };
        grid.appendChild(btn);
      });
    }

    function saveProject() {
      const name = document.getElementById('projectNameInput').value || 'Untitled';
      const projects = JSON.parse(localStorage.getItem('projects') || '[]');
      
      const project = {
        id: Date.now(),
        name: name,
        html: htmlEditor.value,
        css: cssEditor.value,
        js: jsEditor.value,
        date: new Date().toLocaleDateString()
      };
      
      projects.push(project);
      localStorage.setItem('projects', JSON.stringify(projects));
      document.getElementById('projectName').textContent = name;
      
      updateProjectsList();
      alert('‚úÖ Project saved!');
    }

    function updateProjectsList() {
      const projects = JSON.parse(localStorage.getItem('projects') || '[]');
      const list = document.getElementById('projectsList');
      list.innerHTML = '';
      
      projects.forEach(project => {
        const item = document.createElement('div');
        item.className = 'project-item';
        item.innerHTML = `
          <div>
            <strong>${project.name}</strong><br>
            <small>${project.date}</small>
          </div>
          <div class="project-actions">
            <button class="btn-primary" onclick="loadProject(${project.id})">Load</button>
            <button class="btn-red" onclick="deleteProject(${project.id})">Delete</button>
          </div>
        `;
        list.appendChild(item);
      });
    }

    function loadProject(id) {
      const projects = JSON.parse(localStorage.getItem('projects') || '[]');
      const project = projects.find(p => p.id === id);
      
      if (project) {
        htmlEditor.value = project.html;
        cssEditor.value = project.css;
        jsEditor.value = project.js;
        document.getElementById('projectName').textContent = project.name;
        
        addToHistory('html');
        addToHistory('css');
        addToHistory('js');
        updatePreview();
        closeModal('projects');
        alert('‚úÖ Project loaded!');
      }
    }

    function deleteProject(id) {
      if (confirm('Delete this project?')) {
        let projects = JSON.parse(localStorage.getItem('projects') || '[]');
        projects = projects.filter(p => p.id !== id);
        localStorage.setItem('projects', JSON.stringify(projects));
        updateProjectsList();
      }
    }

    function exportProject() {
      const data = {
        name: document.getElementById('projectName').textContent,
        html: htmlEditor.value,
        css: cssEditor.value,
        js: jsEditor.value
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${data.name}.json`;
      a.click();
      URL.revokeObjectURL(url);
      alert('‚úÖ Project exported!');
    }

    function importProject(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            htmlEditor.value = data.html || '';
            cssEditor.value = data.css || '';
            jsEditor.value = data.js || '';
            document.getElementById('projectName').textContent = data.name || 'Imported Project';
            
            addToHistory('html');
            addToHistory('css');
            addToHistory('js');
            updatePreview();
            closeModal('projects');
            alert('‚úÖ Project imported!');
          } catch (err) {
            alert('‚ùå Error importing project');
          }
        };
        reader.readAsText(file);
      }
    }

    function downloadWebsite() {
      const fullHTML = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${document.getElementById('projectName').textContent}</title>
  <style>
${cssEditor.value}
  </style>
</head>
<body>
${htmlEditor.value.replace(/<!DOCTYPE html>|<html[^>]*>|<\/html>|<head[^>]*>|<\/head>|<body[^>]*>|<\/body>/gi, '')}
  <script>
${jsEditor.value}
  <\/script>
</body>
</html>`;

      const blob = new Blob([fullHTML], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${document.getElementById('projectName').textContent}.html`;
      a.click();
      URL.revokeObjectURL(url);
      alert('‚úÖ Website downloaded!');
    }

    // Templates
    function loadTemplate(template) {
      const templates = {
        basic: {
          html: defaultHTML,
          css: defaultCSS
        },
        portfolio: {
          html: `<header><h1>John Doe</h1><p class="tagline">Web Developer</p></header><section><h2>Projects</h2><div class="project-card"><h3>Project 1</h3><p>Amazing project</p></div></section>`,
          css: `body { background: #1a1a2e; color: #eee; font-family: Arial; } header { background: #16213e; padding: 3rem; text-align: center; } .tagline { color: #94a3b8; } section { padding: 2rem; } .project-card { background: #16213e; padding: 1.5rem; margin: 1rem 0; border-radius: 10px; }`
        },
        landing: {
          html: `<div class="hero"><h1>Build Something Amazing</h1><p>Perfect solution</p><button>Get Started</button></div><section><h2>Features</h2><div class="feature"><h3>‚ö° Fast</h3></div></section>`,
          css: `body { margin: 0; font-family: Arial; } .hero { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 5rem 2rem; text-align: center; } .hero button { background: white; color: #667eea; border: none; padding: 1rem 2rem; border-radius: 30px; font-weight: bold; } section { padding: 3rem 2rem; } .feature { background: #f8f9fa; padding: 2rem; border-radius: 10px; text-align: center; }`
        },
        blog: {
          html: `<header><h1>My Blog</h1><nav><a href="#home">Home</a><a href="#about">About</a></nav></header><main><article><h2>Blog Post Title</h2><p class="date">October 31, 2025</p><p>Your blog content goes here...</p></article></main>`,
          css: `body { font-family: Georgia, serif; line-height: 1.8; max-width: 800px; margin: 0 auto; padding: 2rem; } header { text-align: center; padding: 2rem 0; border-bottom: 3px solid #333; } nav { margin-top: 1rem; } nav a { margin: 0 1rem; color: #333; text-decoration: none; } article { margin: 3rem 0; } .date { color: #666; font-style: italic; }`
        },
        restaurant: {
          html: `<header><h1>üçï Bella Italia</h1><p>Authentic Italian Cuisine</p></header><section class="menu"><h2>Menu</h2><div class="menu-item"><h3>Margherita Pizza - $12</h3><p>Fresh mozzarella, tomatoes, basil</p></div><div class="menu-item"><h3>Pasta Carbonara - $14</h3><p>Creamy sauce with bacon</p></div></section>`,
          css: `body { font-family: Arial; background: #fef6e4; } header { background: #f25c54; color: white; padding: 3rem; text-align: center; } .menu { max-width: 800px; margin: 2rem auto; padding: 2rem; } .menu-item { background: white; padding: 1.5rem; margin: 1rem 0; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }`
        },
        resume: {
          html: `<header><h1>Jane Smith</h1><p>Full Stack Developer</p><p>üìß jane@email.com | üì± (555) 123-4567</p></header><section><h2>Experience</h2><div class="job"><h3>Senior Developer</h3><p>Tech Corp | 2020-2025</p><p>Built amazing things...</p></div></section><section><h2>Skills</h2><p>JavaScript, React, Node.js, Python</p></section>`,
          css: `body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 2rem; background: white; color: #333; } header { text-align: center; padding-bottom: 2rem; border-bottom: 2px solid #333; } h1 { font-size: 2.5rem; margin-bottom: 0.5rem; } section { margin: 2rem 0; } h2 { color: #667eea; border-bottom: 1px solid #eee; padding-bottom: 0.5rem; } .job { margin: 1.5rem 0; }`
        },
        gallery: {
          html: `<header><h1>üì∏ Photo Gallery</h1></header><div class="gallery"><img src="https://via.placeholder.com/400x300" alt="Photo 1"><img src="https://via.placeholder.com/400x300" alt="Photo 2"><img src="https://via.placeholder.com/400x300" alt="Photo 3"><img src="https://via.placeholder.com/400x300" alt="Photo 4"></div>`,
          css: `body { font-family: Arial; background: #1a1a2e; color: white; } header { text-align: center; padding: 2rem; } .gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; padding: 2rem; max-width: 1200px; margin: 0 auto; } .gallery img { width: 100%; border-radius: 10px; transition: transform 0.3s; } .gallery img:hover { transform: scale(1.05); }`
        }
      };
      
      const temp = templates[template];
      if (temp) {
        htmlEditor.value = temp.html;
        cssEditor.value = temp.css;
        jsEditor.value = defaultJS;
        addToHistory('html');
        addToHistory('css');
        updatePreview();
        closeModal('templates');
        alert('‚úÖ Template loaded!');
      }
    }

    // Snippets
    function insertSnippet(snippet) {
      const snippets = {
        navbar: '<nav class="navbar">\n  <a href="#home">Home</a>\n  <a href="#about">About</a>\n  <a href="#services">Services</a>\n  <a href="#contact">Contact</a>\n</nav>',
        hero: '<section class="hero">\n  <h1>Welcome to My Site</h1>\n  <p>Subtitle goes here</p>\n  <button>Call to Action</button>\n</section>',
        footer: '<footer>\n  <p>&copy; 2025 Your Name. All rights reserved.</p>\n  <div class="social">\n    <a href="#">Facebook</a>\n    <a href="#">Twitter</a>\n    <a href="#">Instagram</a>\n  </div>\n</footer>',
        form: '<form>\n  <input type="text" placeholder="Name" required>\n  <input type="email" placeholder="Email" required>\n  <textarea placeholder="Message" required></textarea>\n  <button type="submit">Send</button>\n</form>',
        card: '<div class="card">\n  <img src="https://via.placeholder.com/300" alt="Card image">\n  <h3>Card Title</h3>\n  <p>Card description goes here</p>\n  <button>Learn More</button>\n</div>',
        grid: '<div class="image-grid">\n  <img src="https://via.placeholder.com/300" alt="Image 1">\n  <img src="https://via.placeholder.com/300" alt="Image 2">\n  <img src="https://via.placeholder.com/300" alt="Image 3">\n  <img src="https://via.placeholder.com/300" alt="Image 4">\n</div>',
        'button-styles': '.button {\n  padding: 1rem 2rem;\n  border: none;\n  border-radius: 5px;\n  font-weight: bold;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n\n.button:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 8px rgba(0,0,0,0.2);\n}',
        animations: '@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n.fade-in {\n  animation: fadeIn 1s ease-in;\n}\n\n@keyframes slideIn {\n  from { transform: translateX(-100%); }\n  to { transform: translateX(0); }\n}\n\n.slide-in {\n  animation: slideIn 0.5s ease-out;\n}'
      };
      
      const code = snippets[snippet];
      if (code) {
        const editor = snippet.includes('styles') || snippet.includes('animations') ? cssEditor : htmlEditor;
        const type = snippet.includes('styles') || snippet.includes('animations') ? 'css' : 'html';
        const pos = editor.selectionStart;
        editor.value = editor.value.substring(0, pos) + '\n' + code + '\n' + editor.value.substring(pos);
        editor.focus();
        addToHistory(type);
        updatePreview();
        closeModal('snippets');
        alert('‚úÖ Snippet inserted!');
      }
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
